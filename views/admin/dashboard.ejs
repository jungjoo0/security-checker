<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="admin-container">
    <header class="admin-header">
      <div>
        <h1>ğŸ’¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
        <p class="admin-info">
          <%= user.name %> ë‹˜ | <%= user.center_team || user.division || 'ì „ì²´' %>
        </p>
      </div>
      <div class="header-actions">
        <a href="/logout" class="btn btn-secondary">ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </header>

    <div class="admin-content">
      <div class="action-bar">
        <div class="date-filter">
          <h2>ğŸ“Š ë³´ì•ˆ ì²´í¬ í˜„í™©</h2>
          <div class="date-selector">
            <label for="dateSelect">ì¡°íšŒ ë‚ ì§œ:</label>
            <input type="date" id="dateSelect" value="<%= selectedDate %>" onchange="changeDate()">
          </div>
        </div>
        <div class="action-buttons">
          <% if (user.employee_id === 'admin') { %>
            <button onclick="showUploadModal('employee')" class="btn btn-outline">
              ğŸ“¤ êµ¬ì„±ì› ì—…ë¡œë“œ
            </button>
            <button onclick="showUploadModal('admin')" class="btn btn-outline">
              ğŸ“¤ ê´€ë¦¬ì ì—…ë¡œë“œ
            </button>
          <% } %>
          <a href="/admin/download-excel" class="btn btn-primary">
            ğŸ“¥ ëˆ„ì  ë°ì´í„° ë‹¤ìš´ë¡œë“œ
          </a>
        </div>
      </div>

      <div class="stats-summary">
        <div class="stat-card">
          <div class="stat-number"><%= employees.length %></div>
          <div class="stat-label">ì „ì²´ ì¸ì›</div>
        </div>
        <div class="stat-card success">
          <div class="stat-number"><%= employees.filter(e => e.today_status === 'ì™„ë£Œ').length %></div>
          <div class="stat-label">ì²´í¬ ì™„ë£Œ</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-number"><%= employees.filter(e => e.today_status === 'ë¯¸ì™„ë£Œ').length %></div>
          <div class="stat-label">ë¯¸ì™„ë£Œ</div>
        </div>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>ì‚¬ë²ˆ</th>
              <th>ì´ë¦„</th>
              <th>ì§ì±…</th>
              <th>ë³¸ë¶€</th>
              <th>ì„¼í„°/íŒ€</th>
              <th>ê·¸ë£¹</th>
              <th>ì‹¤</th>
              <th>ê¸ˆì¼ ì²´í¬</th>
              <th>ì²´í¬ ì‹œê°„</th>
              <th>ëˆ„ì  íšŸìˆ˜</th>
            </tr>
          </thead>
          <tbody>
            <% if (employees.length === 0) { %>
              <tr>
                <td colspan="10" style="text-align: center; padding: 40px;">
                  ë“±ë¡ëœ êµ¬ì„±ì›ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                  êµ¬ì„±ì› ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.
                </td>
              </tr>
            <% } else { %>
              <% employees.forEach(emp => { %>
                <tr>
                  <td><%= emp.employee_id %></td>
                  <td><%= emp.name %></td>
                  <td><%= emp.job_type || '-' %></td>
                  <td><%= emp.division || '-' %></td>
                  <td><%= emp.center_team || '-' %></td>
                  <td><%= emp.group_name || '-' %></td>
                  <td><%= emp.department || '-' %></td>
                  <td>
                    <span class="status-badge <%= emp.today_status === 'ì™„ë£Œ' ? 'completed' : 'pending' %>">
                      <%= emp.today_status %>
                    </span>
                  </td>
                  <td><%= emp.check_time || '-' %></td>
                  <td><%= emp.total_checks %>íšŒ</td>
                </tr>
              <% }); %>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ì—…ë¡œë“œ ëª¨ë‹¬ -->
  <div id="uploadModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeUploadModal()">&times;</span>
      <h2 id="modalTitle">íŒŒì¼ ì—…ë¡œë“œ</h2>
      <p id="modalDescription"></p>
      
      <form id="uploadForm" enctype="multipart/form-data">
        <div class="form-group">
          <label for="file">ì—‘ì…€ íŒŒì¼ ì„ íƒ</label>
          <input type="file" id="file" name="file" accept=".xlsx, .xls" required>
        </div>
        
        <div class="file-format-info">
          <strong>ğŸ“‹ ì—‘ì…€ íŒŒì¼ í˜•ì‹:</strong>
          <ul>
            <li>ì‚¬ë²ˆ</li>
            <li>ì´ë¦„</li>
            <li>ì§êµ°</li>
            <li>ë³¸ë¶€</li>
            <li>ì„¼í„°/íŒ€</li>
            <li>ê·¸ë£¹</li>
            <li>ì‹¤</li>
          </ul>
          <small>* ì²« ë²ˆì§¸ í–‰ì´ í—¤ë”ì—¬ì•¼ í•©ë‹ˆë‹¤.</small>
        </div>
        
        <button type="submit" class="btn btn-primary btn-block">ì—…ë¡œë“œ</button>
      </form>
    </div>
  </div>

  <script>
    let uploadType = '';
    
    function changeDate() {
      const selectedDate = document.getElementById('dateSelect').value;
      window.location.href = '/admin/dashboard?date=' + selectedDate;
    }
    
    function showUploadModal(type) {
      uploadType = type;
      const modal = document.getElementById('uploadModal');
      const title = document.getElementById('modalTitle');
      const description = document.getElementById('modalDescription');
      
      if (type === 'employee') {
        title.textContent = 'êµ¬ì„±ì› ì •ë³´ ì—…ë¡œë“œ';
        description.textContent = 'êµ¬ì„±ì› ì •ë³´ê°€ ë‹´ê¸´ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.';
      } else {
        title.textContent = 'ê´€ë¦¬ì ì •ë³´ ì—…ë¡œë“œ';
        description.textContent = 'ê´€ë¦¬ì ì •ë³´ê°€ ë‹´ê¸´ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”. (ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: 1234)';
      }
      
      modal.style.display = 'block';
    }
    
    function closeUploadModal() {
      document.getElementById('uploadModal').style.display = 'none';
      document.getElementById('uploadForm').reset();
    }
    
    window.onclick = function(event) {
      const modal = document.getElementById('uploadModal');
      if (event.target === modal) {
        closeUploadModal();
      }
    }
    
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData();
      const fileInput = document.getElementById('file');
      formData.append('file', fileInput.files[0]);
      
      const url = uploadType === 'employee' ? '/admin/upload-employees' : '/admin/upload-admins';
      
      try {
        const response = await fetch(url, {
          method: 'POST',
          body: formData,
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert(data.message);
          closeUploadModal();
          location.reload();
        } else {
          alert(data.message);
        }
      } catch (error) {
        alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
  </script>
</body>
</html>
