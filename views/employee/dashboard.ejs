<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë³´ì•ˆ ì²´í¬</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="mobile-page">
  <div class="mobile-container">
    <div class="header">
      <div class="user-info">
        <h2>ğŸ‘¤ <%= user.name %> ë‹˜</h2>
        <p>ì‚¬ë²ˆ: <%= user.employee_id %></p>
      </div>
      <a href="/logout" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
    </div>

    <div class="stats-box">
      <div class="stat-item">
        <span class="stat-label">ëˆ„ì  ì²´í¬</span>
        <span class="stat-value"><%= totalChecks %>íšŒ</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">ì˜¤ëŠ˜ ì²´í¬</span>
        <span class="stat-value <%= todayRecord ? 'completed' : 'pending' %>">
          <%= todayRecord ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ' %>
        </span>
      </div>
    </div>

    <% if (todayRecord) { %>
      <div class="alert alert-success">
        <h3>âœ… ì˜¤ëŠ˜ì˜ ë³´ì•ˆ ì²´í¬ ì™„ë£Œ!</h3>
        <p>ì²´í¬ ì‹œê°„: <%= todayRecord.check_time %></p>
        <p>ë‚´ì¼ ë‹¤ì‹œ ì²´í¬í•´ì£¼ì„¸ìš”.</p>
      </div>
    <% } else { %>
      <div class="checklist-box">
        <h2>ğŸ”’ ë³´ì•ˆ ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
        <p class="checklist-subtitle">ì—…ë¬´ ì¢…ë£Œ í›„ ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”</p>
        
        <form id="checklistForm">
          <div class="checklist-item">
            <input type="checkbox" id="check1" name="pc_shutdown" value="1">
            <label for="check1">
              <span class="check-icon">ğŸ’»</span>
              <span class="check-text">PC ì „ì›ì„ ì¢…ë£Œ í•˜ì˜€ìŠµë‹ˆê¹Œ?</span>
            </label>
          </div>
          
          <div class="checklist-item">
            <input type="checkbox" id="check2" name="lock_check" value="1">
            <label for="check2">
              <span class="check-icon">ğŸ”</span>
              <span class="check-text">ì ê¸ˆ ì¥ì¹˜(ìºë¹„ë‹›/ì„œëì¥) ì‹œê±´ì„ í•˜ì˜€ìŠµë‹ˆê¹Œ?</span>
            </label>
          </div>
          
          <div class="checklist-item">
            <input type="checkbox" id="check3" name="document_security" value="1">
            <label for="check3">
              <span class="check-icon">ğŸ“„</span>
              <span class="check-text">ê°œì¸ì •ë³´ ë° ëŒ€ì™¸ë¹„ ìë£Œ ë³´ê´€/ì‹œê±´ì„ í•˜ì˜€ìŠµë‹ˆê¹Œ?</span>
            </label>
          </div>
          
          <button type="submit" class="btn btn-primary btn-block" id="saveBtn" disabled>
            ì €ì¥í•˜ê¸°
          </button>
        </form>
      </div>
    <% } %>
  </div>

  <script>
    const form = document.getElementById('checklistForm');
    const saveBtn = document.getElementById('saveBtn');
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    
    if (form) {
      // ëª¨ë“  ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
      function updateSaveButton() {
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        saveBtn.disabled = !allChecked;
      }
      
      checkboxes.forEach(cb => {
        cb.addEventListener('change', updateSaveButton);
      });
      
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        if (!allChecked) {
          alert('ëª¨ë“  í•­ëª©ì„ ì²´í¬í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const formData = {
          pc_shutdown: document.getElementById('check1').checked ? 1 : 0,
          lock_check: document.getElementById('check2').checked ? 1 : 0,
          document_security: document.getElementById('check3').checked ? 1 : 0,
        };
        
        try {
          const response = await fetch('/employee/save-check', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
          });
          
          const data = await response.json();
          
          if (data.success) {
            alert(data.message);
            location.reload();
          } else {
            alert(data.message);
          }
        } catch (error) {
          alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      });
    }
  </script>
  <footer style="position: fixed; bottom: 0; width: 100%; text-align: center; padding: 10px; background: rgba(255, 255, 255, 0.95); color: #666; font-size: 0.75rem; box-shadow: 0 -2px 10px rgba(0,0,0,0.1);">
    Â© ì„œë¹„ìŠ¤ì—ì´ìŠ¤ AIì „ëµíŒ€
  </footer>
</body>
</html>
